<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no,uc-fitscreen=yes"/>
    <title>腾讯大王卡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        input {
            outline: none;
            border: none;
        }
        
        a {
            text-decoration: none;
            color: #d48e6b;
            font-size: 12px;
            font-weight: 500;
        }
        
        .content {
            /* width: 90%; */
            margin: 0 auto;
            max-width: 600px;
        }
        
        section {
            background-color: #343da8;
            margin: 0 auto;
            margin-top: -1px;
            width: 100%;
        }
        
        .form_part {
            margin: 0 4%;
            padding-left: 4px;
        }
        
        .form_part .title {
            font-size: 14px;
            color: #313131;
            font-weight: bold;
            background-color: #d4d4d4;
            padding: 4% 0;
            padding-left: 5%;
        }
        
        .infor,
        .last {
            background-color: #fff;
            padding-left: 5%;
            padding-bottom: 10px;
            /* height: 100px; */
        }
        
        .infor>div {
            font-size: 14px;
            font-weight: bold;
            border-bottom: 1px solid #cccccc;
            padding: 4% 0
        }
        
        .infor>div:last-child {
            border-bottom: none;
        }
        
        .infor span {
            display: inline-block;
            width: 25%;
            position: relative;
        }
        
        .infor span::before {
            content: '*';
            display: inline-block;
            width: 2px;
            height: 2px;
            color: red;
            padding-right: 5px;
            font-weight: bold;
        }
        
        .last {
            background-color: #f7f7f7;
            margin-top: -1px;
        }
        
        .last span {
            font-size: 14px;
            color: #9f9f9f;
            font-weight: 500;
        }
        
        input {
            font-size: 14px;
            color: #151617;
        }
        
        img {
            width: 100%;
            height: 100%;
            font-size: 0px;
        }
        
        input[type="radio"] {
            width: 1.25rem;
            height: 1.25rem;
            vertical-align: text-bottom;
            margin-right: 16px;
        }
        
        .button {
            background-color: #daa95d;
            width: 95%;
            color: #fff;
            font-size: 16px;
            padding: 3% 0;
            text-align: center;
            border-radius: 4px;
            margin-top: 4%;
        }
        
        .desc {
            font-size: 11px;
            margin-top: 10px;
            width: 100%;
            /* margin-left: 10%; */
            text-align: center;
        }
        
        .desc>div:first-child {
            color: red;
        }
        .collapse{
            margin-left: 45%;
            border: solid 3px #999;
            border-top: 10px;
            border-left: 10px;
            display: inline-block;
            height: 20px;
            width: 20px;
            transform: rotate(45deg);
            transition: transform 0.2s;
        }
    </style>
    <link rel="stylesheet" th:href="@{/static/css/weui.min.css}">
    <link rel="stylesheet" th:href="@{/static/css/jquery-weui.css}">
    <script type="text/javascript" th:src="@{/static/js/jquery-2.1.4.js}"></script>
</head>

<body>
    <div class="content">
        <div style="font-size:0"><img th:src="@{/static/images/01.jpg}" alt=""></div>
        <div style="font-size:0"><img th:src="@{/static/images/02.jpg}" alt=""></div>
        <form action="" id="dataForm" method="post" >
        <!-- 表单模块 start -->
        <section>
            <div class="form_part">
                <div class="title">根据国家实名制要求,请准确提供有效证件信息</div>
                <div class="infor">
                    <div><span>姓名</span><input id="certName" name="certName" type="text" placeholder="请输入有效证件姓名"></div>
                    <div><span>联系电话</span><input id="custPhone" name="custPhone" type="text" placeholder="请输入联系电话"></div>
                    <div><p style="display: inline-block;width: 25%;">归属地</p>
                        <div style="display: inline-block;" id="sel_city2"><input id="start2" placeholder="点击选取省市" value=""/></div>
                    </div>
                    <div class="weui-cells" style="height: 56px;margin-top: 0px;">
                        <a class="weui-cell weui-cell_access">
                            <div class="weui-cell__bd">
                                <p style="font-size: 14px;font-weight: bold;margin-left: -10px;margin-top:-7px;">选择号码
                                    <tl style="margin-left:24px;color: #999;padding-right: 10px;" value="" id="selectNo"></tl>
                                    <img style="display:none;max-height: 10px;max-width: 10px;"
                                         th:src="@{/static/images/close.png}" title="删除" alt="删除" id="closeImg" onclick="removeSelect()">
                                </p>
                            </div>
                            <div class="weui-cell__ft" style="font-size: 12px;margin-top: -12px;" onclick="selectNo();">点击选择</div>
                        </a>
                    </div>
                    <p class="collapse" id="jiantou" status="1"></p>
                    <div id="careIdDiv" style="display: none;"><span>身份证号</span><input id="certId" name="certId" type="text" placeholder="请输入身份证"></div>
                </div>
                <div class="title">请填写配送地址</div>
                <div class="infor">
                    <div><span>所在地区</span>
                        <div style="display: inline-block;" id="sel_city"><input id="start" placeholder="点击选取省市区" value=""/></div>
                    </div>
                    <div><span>详细地址</span><input style="width: 100%;" id="userAddr" name="userAddr" type="text" placeholder="街道/镇+村/小区/写字楼+门牌号"></div>
                </div>
                <div class="last">
                    <!--<div style="padding-top: 10px;">
                        <input id="confirm" name="confirm" type="radio" value="" />
                        <span>我已阅读并同意 </span>
                        <a href="#"> 《客户入网服务协议及业务协议》</a>
                    </div>
                    <div style="margin-left: 30%;margin-top: 7px;">
                        <a href="#">《业务办理公告》</a>
                    </div>-->
                    <div style="padding-top: 10px;"></div>
                    <div class="button" id="submitBtn">
                        立即提交 免费送货上门
                    </div>
                    <div class="desc">
                        <div><span style="color: red;vertical-align: text-top;">*</span>1、未满16周岁的,因政治原因不发货,请勿下单。</div>
                        <div><span style="vertical-align: text-top;">*</span>2、请保持电话通畅，我们将随时可能与您联系。</div>
                    </div>
                </div>
            </div>

        </section>
            <div id="popupDiv" class="weui-popup__container popup-bottom" style="align-content: center;">
                <div class="weui-popup__overlay"></div>
                <div class="weui-popup__modal" style="min-height: 60%;max-width: 600px;">
                    <div class="toolbar">
                        <div class="toolbar-inner">
                            <a href="javascript:;" class="picker-button close-popup">关闭</a>
                            <h1 class="title">选取手机号</h1>
                        </div>
                    </div>
                    <div class="modal-content">
                        <div class="weui-cells">
                            <div class="weui-cell">
                                <div class="weui-cell__hd"><label class="weui-label">手机尾号</label></div>
                                <div class="weui-cell__bd">
                                    <input class="weui-input" id="searchValue" type="number" pattern="[0-4]*" placeholder="输入2-4位手机尾号">
                                </div>
                                <div class="weui-cell__ft">
                                    <a href="javascript:void(0);" class="weui-vcode-btn" id="queryNumber">查询</a>
                                </div>
                            </div>
                            <div class="weui-cells" id="nums" style="max-height: 400px;overflow-y:scroll;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <!-- 表单模块 end -->
        <div style="font-size:0;margin-top: -1px;"><img th:src="@{/static/images//04.jpg}" alt=""></div>
        <div style="font-size:0;margin-top: -1px;"><img th:src="@{/static/images//05.jpg}" alt=""></div>
        <div style="font-size:0;margin-top: -1px;"><img th:src="@{/static/images//06.jpg}" alt=""></div>
        <div style="font-size:0;margin-top: -1px;"><img th:src="@{/static/images//07.jpg}" alt=""></div>
    </div>

</body>
<script type="text/javascript" th:src="@{/static/js/jquery-weui.min.js}"></script>
<script type="text/javascript" th:src="@{/static/js/city-data.js}"></script>
<script type="text/javascript" th:src="@{/static/js/city-picker.js}"></script>
<script type="text/javascript" th:src="@{/static/js/index.js}"></script>
<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/
    var province = "";
    var cityCode = "";
    var countyCode = "";
    //归属地省份
    var ownerProvince = "";
    //归属地城市
    var ownerCityCode = "";
    $(function () {

        //是否正在提交标识
        let submitFlg = false;
        //归属地地址选择器
        $("#start2").cityPicker({
            title: "选择归属地",
            showDistrict:false,
            onChange: function (picker, values, displayValues) {
                ownerProvince = values[0];
                ownerCityCode = values[1];
            }
        });
        $("#start").cityPicker({
            title: "选择所在地",
            onChange: function (picker, values, displayValues) {
                province = values[0];
                cityCode = values[1];
                countyCode = values[2];
            }
        });
        //为箭头添加点击事件
        $("#jiantou").on("click",function (e) {
            let dom = $("#jiantou")
            let status = dom.attr("status");
            if(status == "1"){
                dom.css("transform","rotate(225deg)")
                dom.attr("status","2")
                $("#careIdDiv").show();

            }else{
                $("#careIdDiv").hide();
                dom.css("transform","rotate(45deg)")
                dom.attr("status","1")
            }
        });
        $("#submitBtn").on("click",function () {
            //若正在提交，则不进行提交操作
            if(submitFlg){
                return;
            }
            //表单验证通过
            if(checkFormDate()){

                let url = /*[[@{/kingOrder/orderSubmit}]]*/"";

                let certName = $("#certName").val();

                let custPhone = $("#custPhone").val();

                let certId = $("#certId").val();
                let userAddr = $("#userAddr").val();
                //所选号码
                let serialNumber = $("#selectNo").attr("value");

                let data = {"certName":certName,"custPhone":custPhone,"certId":certId,"userAddr":userAddr,
                    "province":province,"cityCode":cityCode,"countyCode":countyCode,"serialNumber":serialNumber
                    ,"ownerProvince":ownerProvince,"ownerCityCode":ownerCityCode};

                $.ajax({
                    type:"post",
                    url:url,
                    cache: false,
                    async: true,
                    data:data,
                    dataType: 'json',
                    beforeSend:function(e){
                        //设置为true,表示正在提交
                        submitFlg = true;
                        $.showLoading("正在提交...")
                        //$("#submitBtn").css("background-color","#b1afac").html("正在提交...");

                    },
                    success:function(data){
                        $.hideLoading();
                        var code = data.code;
                        var message = data.message;
                        if(code == 200){
                            $.toast("提交成功");
                            clearForm();
                        }else{
                            $.toast(message,"text");
                        }
                    },
                    complete:function (e) {
                        //表示已经提交完成
                        submitFlg = false;
                        //$("#submitBtn").css("background-color","#daa95d").html("立即提交 免费送货上门");
                        setTimeout(function () {
                            $.hideLoading();
                        },3000);

                    }
                });
            }

        });
        $("#nums").on("click","p[num]",function (e) {
            var dom = $(this);
            var num = dom.attr("num");
            selectNumber(num);
        })
        //绑定查询事件
        $("#queryNumber").on("click",function () {

            let searchValue = $("#searchValue").val();
            let url = /*[[@{/kingOrder/querySelectNumber}]]*/"";

            let data = {"provinceCode":ownerProvince,"cityCode":ownerCityCode,"searchValue":searchValue};

            $.ajax({
                type:"post",
                url:url,
                cache: false,
                async: true,
                data:data,
                dataType: 'json',
                beforeSend:function(e){
                    //设置为true,表示正在提交
                    submitFlg = true;
                },
                success:function(data){
                    var code = data.code;
                    var message = data.message;
                    if(code == 200){
                       var nums = data.data;
                       if(nums != null && nums.length > 0){
                           //创建手机号
                           createSelectNum(nums);
                       }else{
                           $.toast("未查询到数据","text");
                       }
                    }else{
                        $.toast(message,"text");
                    }
                },
                complete:function (e) {
                    //表示已经提交完成
                    submitFlg = false;
                }
            });
        });
    })
    /**
     * 检查表单数据
     **/
    function checkFormDate(){
        let certName = $("#certName").val();
        let custPhone = $("#custPhone").val();
        let certId = $("#certId").val();
        let userAddr = $("#userAddr").val();
        let selectNo = $("#selectNo").attr("value");

        if(certName == null || certName == ""){
            $.toast("请填写您的姓名信息","text");
            $("#certName").focus();
            return false;
        }else if(!checkName(certName)){
            $.toast("请填写正确的姓名信息","text");
            $("#certName").focus();
            return false;
        }

        if(custPhone == null || custPhone == ""){
            $.toast("请填写您的联系电话","text");
            $("#custPhone").focus();
            return false;
        }else if(!checkPhone(custPhone)){
            $.toast("联系电话格式不正确","text");
            $("#custPhone").focus();
            return false;
        }
        if(certId == null || certId == ""){
            if($("#jiantou").attr("status") == "1"){
                $("#jiantou").click();
            }
            $.toast("请填写您的身份证号","text");
            $("#certId").focus();
            return false;
        }else if(!checkCard(certId)){
            if($("#jiantou").attr("status") == "1"){
                $("#jiantou").click();
            }
            $.toast("身份证号格式不正确","text");
            $("#certId").focus();
            return false;
        }
        if(province == null || province == ""){
            $.toast("请选择您的所在区域","text");
            $("#start").focus();
            return false;
        }

        if(cityCode == null || cityCode == ""){
            $.toast("请选择您的所在区域","text");
            $("#start").focus();
            return false;
        }
        if(countyCode == null || countyCode == ""){
            $.toast("请选择您的所在区域","text");
            $("#start").focus();
            return false;
        }
        if(userAddr == null || userAddr == ""){
            $.toast("请填写详细地址","text");
            $("#userAddr").focus();
            return false;
        }
        if(selectNo != ""){
            if(ownerProvince == "" || ownerCityCode == ""){
                $.toast("请选择归属地","text");
                $("#start2").focus();
            }
        }
        return true;
    }
    //清楚表单数据
    function clearForm() {
        $("#certName").val("");
        $("#custPhone").val("");
        $("#certId").val("");
        $("#userAddr").val("");
        $("#selectNo").attr("value","");
        $("#selectNo").html("");
        $("#nums").empty();
        $("#searchValue").val("");
        $("#closeImg").hide();

    }
    /*
     * 选择手机号
     */
    function selectNo() {
        if(ownerProvince == "" || ownerCityCode == ""){
            $.toast("请先选择手机号归属地","text");
            return;
        }
        $("#popupDiv").popup();
    }
    //选中号码后
    function selectNumber(num) {
        $("#selectNo").attr("value",num);
        $("#selectNo").html(num);
        $("#closeImg").show();
        $.closePopup();
    }
    //删除选中的号码
    function removeSelect() {
        $("#selectNo").attr("value","");
        $("#selectNo").html("");
        $("#closeImg").hide();
    }
    //创建返回的查询结果
    function createSelectNum(nums){
        let maxRow = 24;
        if(nums != null && nums.length > 0){
            let numsDom = $("#nums");
            //删除孩子节点
            numsDom.empty();
            let max = nums.length>maxRow?maxRow:nums.length;
            let isEnd = false;
            for(i =0;i<max;i++){
                if(isEnd){
                    break;
                }
                let num = nums[i];
                let num2 = null;

                if(i+1 <= max){
                    num2 = nums[i+1];
                    if(i+1== max){
                        isEnd = true;
                    }
                    //自动+1
                    i++;
                }else{
                    isEnd = true;
                }
                //创建子节点
                let content = createItmeHtml(num,num2);
                numsDom.append(content);

            }
        }
    }

    function createItmeHtml(num,num2){
        let content = "<div class=\"weui-cell\">\n"
            + "<div class=\"weui-cell__bd\">\n"
            + "   <p num=\""+num+"\" style=\"margin-left: 15px;text-decoration: underline #47E;\">"+num+"</p>\n"
            + "</div>\n";
            if(num2 != null){
                content += "<div class=\"weui-cell__ft\">\n"
                 +"   <p num=\""+num2+"\" style='margin-right: 30px;color:#3d4145;text-decoration: underline #47E;'>"+num2+"</p>\n"
                 + "</div>\n";
            }
        content += "</div>";
        return content;
    }
    /*]]>*/
</script>
</html>